<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard v2.6</title>
<style>
  body {
    margin: 0;
    background: black;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    text-align: center;
  }

  #container {
    display: block;
    padding-top: 50px;
  }

  #time {
    font-size: 60px;
    font-weight: bold;
  }

  #date {
    font-size: 24px;
    margin-top: 10px;
  }

  #weather {
    font-size: 24px;
    margin-top: 20px;
  }

  #weather-text {
    font-size: 20px;
    margin-top: 10px;
    color: #ccc;
  }

  #version-badge {
    position: fixed;
    top: 12px;
    right: 12px;
    background: rgba(255,255,255,0.1);
    color: #fff;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 13px;
    border: 1px solid rgba(255,255,255,0.2);
    z-index: 9999;
  }
</style>
</head>
<body>

<div id="container">
  <div id="time">--:--</div>
  <div id="date">Loading date...</div>
  <div id="weather">Loading weather...</div>
  <div id="weather-text">Loading weather text...</div>
</div>

<div id="version-badge">v2.6</div>

<script>
// ----- CLOCK -----
var timeEl = document.getElementById('time');
var dateEl = document.getElementById('date');

function updateClock() {
  var now = new Date();
  var hours = now.getHours();
  var minutes = now.getMinutes();
  if(hours > 12) { hours -= 12; }
  if(hours === 0) { hours = 12; }
  if(minutes < 10) { minutes = '0' + minutes; }
  timeEl.innerHTML = hours + ':' + minutes;

  var month = now.getMonth() + 1;
  var day = now.getDate();
  var year = now.getFullYear();
  dateEl.innerHTML = month + '/' + day + '/' + year;
}
setInterval(updateClock, 1000);
updateClock();

// ----- WEATHER -----
var weatherEl = document.getElementById('weather');
var weatherTextEl = document.getElementById('weather-text');

var url = "https://wttr.in/Greenfield,MA?format=2&u";

// emoji mapping
var emojiMap = {
  "🌫": "Foggy",
  "☀️": "Sunny",
  "☁️": "Cloudy",
  "🌧️": "Rainy",
  "🌨️": "Snowy",
  "🌬️": "Wind",
  "🌡️": ""
};

// wind direction mapping
var windDirMap = {
  "↖": "NW", "↑": "N", "↗": "NE", "→": "E",
  "↘": "SE", "↓": "S", "↙": "SW", "←": "W"
};

var xhr = new XMLHttpRequest();
xhr.open('GET', url, true);
xhr.onreadystatechange = function() {
  if(xhr.readyState === 4){
    if(xhr.status === 200){
      var emojiString = xhr.responseText;
      weatherEl.innerText = emojiString; // display emojis

      // ---- convert to clean plain text ----
      var plainText = emojiString
        .replace(/🌫|☀️|☁️|🌧️|🌨️|🌬️|🌡️/g, function(match){ return emojiMap[match]; })
        .replace(/[↖↑↗→↘↓↙←]/g, function(match){ return windDirMap[match]; })
        .replace(/\+/g,'') // remove plus signs
        .replace(/Temp/,'') // remove "Temp" placeholder
        .trim();

      // add commas and spacing
      // split on spaces, insert commas before wind
      var parts = plainText.split(/\s+/);
      var weatherDescription = parts.slice(0, parts.length-2).join(' ');
      var temperature = parts[parts.length-2] || '';
      var wind = parts[parts.length-1] || '';
      weatherTextEl.innerText = weatherDescription + ', ' + temperature + ', ' + wind;

      console.log("Plain text weather:", weatherTextEl.innerText); // for debugging
    } else {
      weatherEl.innerText = "Weather unavailable";
      weatherTextEl.innerText = "Weather unavailable";
    }
  }
};
xhr.send();
</script>

</body>
</html>
