<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clock + Weather Forecast v1.2</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: black;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    text-align: center;
    position: relative;
  }

  #container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #time {
    font-size: 10vw;
    font-weight: 600;
    line-height: 1;
  }

  #seconds {
    font-size: 4vw;
    vertical-align: super;
  }

  #date {
    font-size: 3vw;
    margin-top: 1vw;
  }

  #weather {
    font-size: 3vw;
    margin-top: 2vw;
  }

  #forecast {
    font-size: 2vw;
    margin-top: 2vw;
    line-height: 1.6;
    max-width: 90vw;
  }

  .forecast-item {
    margin: 0.5vw 0;
  }

  #version-badge {
    position: fixed;
    top: 12px;
    right: 12px;
    background: rgba(255,255,255,0.1);
    color: #fff;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 13px;
    border: 1px solid rgba(255,255,255,0.2);
    z-index: 9999;
  }

  #raw-url {
    font-size: 1.5vw;
    margin-top: 1vw;
    color: #aaa;
    word-break: break-all;
  }
</style>
</head>
<body>
<div id="container">
  <div id="time">--:--<span id="seconds">--</span></div>
  <div id="date">Loading date...</div>
  <div id="weather">Loading weather...</div>
  <div id="forecast">Loading forecast...</div>
  <div id="raw-url"></div>
</div>

<div id="version-badge">v1.2</div>

<script>
const timeEl = document.getElementById("time");
const secEl = document.getElementById("seconds");
const dateEl = document.getElementById("date");
const weatherEl = document.getElementById("weather");
const forecastEl = document.getElementById("forecast");
const rawUrlEl = document.getElementById("raw-url");

// CITY + STATE instead of ZIP
const LOCATION = "Amherst,MA";
const API_URL = `https://wttr.in/${encodeURIComponent(LOCATION)}?format=j1&u=f`;

// Show API URL for debugging
rawUrlEl.textContent = `Fetching from: ${API_URL}`;

// CLOCK
function updateClock() {
  const now = new Date();
  let hours = now.getHours();
  const minutes = now.getMinutes().toString().padStart(2,"0");
  const seconds = now.getSeconds().toString().padStart(2,"0");
  hours = hours % 12 || 12;

  timeEl.firstChild.nodeValue = `${hours}:${minutes}`;
  secEl.textContent = seconds;
  dateEl.textContent = now.toDateString();
}

setInterval(updateClock, 1000);
updateClock();

// WEATHER
async function getWeather() {
  try {
    const res = await fetch(API_URL);
    if (!res.ok) throw new Error("Failed to fetch weather");
    const data = await res.json();

    const now = new Date();
    const currentHour = now.getHours();

    // CURRENT CONDITIONS
    const current = data.current_condition[0];
    const tempF = current.temp_F;
    const condition = current.weatherDesc[0].value;
    weatherEl.textContent = `Now: ${tempF}°F, ${condition}`;

    // TODAY'S HOURLY FORECAST (all remaining blocks from now)
    const todayHours = data.weather[0].hourly
      .filter(h => parseInt(h.time, 10)/100 >= currentHour);

    forecastEl.innerHTML = "<strong>Today’s remaining forecast:</strong><br>";

    todayHours.forEach(h => {
      const timeLabel = formatTime(h.time);
      const desc = h.weatherDesc[0].value;
      const temp = h.tempF;
      const rain = h.chanceofrain;
      const item = document.createElement("div");
      item.classList.add("forecast-item");
      item.textContent = `${timeLabel}: ${temp}°F, ${desc} (Rain: ${rain}%)`;
      forecastEl.appendChild(item);
    });

    if(todayHours.length === 0){
      forecastEl.innerHTML += "No remaining forecast blocks for today.";
    }

  } catch(err) {
    console.error(err);
    weatherEl.textContent = "Weather unavailable.";
    forecastEl.textContent = "";
  }
}

// Convert wttr time ("0", "300", "600", …) to readable format
function formatTime(t){
  const num = parseInt(t,10);
  const hours = Math.floor(num/100);
  const date = new Date();
  date.setHours(hours);
  date.setMinutes(0);
  return date.toLocaleTimeString([], { hour:'numeric', hour12:true });
}

getWeather();
</script>
</body>
</html>
