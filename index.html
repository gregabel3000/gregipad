<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gregâ€™s Clock</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      font-family: "SF Pro Display", -apple-system, BlinkMacSystemFont, sans-serif;
      color: white;
    }

    #gradient-bg {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(to bottom right, #2b5876, #4e4376);
      z-index: 0;
    }

    #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.4);
      z-index: 1;
    }

    #clock {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 2;
    }

    #time {
      font-size: 14vw;
      letter-spacing: -0.02em;
    }

    #seconds {
      font-size: 5vw;
      vertical-align: super;
    }

    #date {
      font-size: 3vw;
      margin-top: 1vw;
    }

    #diag {
      position: fixed;
      bottom: 10px; left: 10px;
      font-size: 0.9vw;
      color: rgba(255, 255, 255, 0.7);
      z-index: 3;
    }
  </style>
</head>
<body>
  <div id="gradient-bg"></div>
  <div id="overlay"></div>

  <div id="clock">
    <div id="time">--:--<span id="seconds">--</span></div>
    <div id="date">Loading...</div>
  </div>

  <div id="diag">Starting...</div>

  <script>
    const timeEl = document.getElementById("time");
    const secEl = document.getElementById("seconds");
    const dateEl = document.getElementById("date");
    const diagEl = document.getElementById("diag");
    const bgEl = document.getElementById("gradient-bg");

    function setDiag(text) {
      diagEl.textContent = text;
    }

    function updateClock() {
      const now = new Date();
      const hours = now.getHours().toString().padStart(2, "0");
      const minutes = now.getMinutes().toString().padStart(2, "0");
      const seconds = now.getSeconds().toString().padStart(2, "0");
      timeEl.firstChild.nodeValue = `${hours}:${minutes}`;
      secEl.textContent = seconds;

      const options = { weekday: "long", month: "long", day: "numeric" };
      dateEl.textContent = now.toLocaleDateString(undefined, options);
    }

    setInterval(updateClock, 1000);
    updateClock();

    function tryImageSequence(urls, success, failure) {
      let index = 0;
      function tryNext() {
        if (index >= urls.length) {
          failure();
          return;
        }
        const img = new Image();
        img.onload = () => success(urls[index]);
        img.onerror = () => {
          index++;
          tryNext();
        };
        img.src = urls[index];
      }
      tryNext();
    }

    function loadBackground() {
      setDiag("Loading image...");

      // Grab a random image from Pexels (randomized query each time)
      const query = ["forest", "mountains", "city lights", "night sky", "sunrise", "ocean", "winter", "foggy landscape"];
      const randomQuery = query[Math.floor(Math.random() * query.length)];
      const base = "https://images.pexels.com/photos/";
      const photos = [
        "1103970", "414171", "158827", "355465", "771883", "1323550", "3408744", "2387418"
      ];
      const randomId = photos[Math.floor(Math.random() * photos.length)];
      const small = `${base}${randomId}/pexels-photo-${randomId}.jpeg?auto=compress&cs=tinysrgb&w=640`;
      const medium = `${base}${randomId}/pexels-photo-${randomId}.jpeg?auto=compress&cs=tinysrgb&w=1280`;
      const original = `${base}${randomId}/pexels-photo-${randomId}.jpeg?auto=compress&cs=tinysrgb`;

      tryImageSequence([small, medium, original],
        function(workingUrl) {
          setDiag("Loaded: " + workingUrl);
          bgEl.style.backgroundImage = `url('${workingUrl}')`;
          bgEl.style.backgroundSize = "cover";
          bgEl.style.backgroundPosition = "center";
          bgEl.style.backgroundRepeat = "no-repeat";
        },
        function() {
          setDiag("All variants failed to load.");
        }
      );
    }

    loadBackground();

    // Refresh background every 6 hours
    setInterval(loadBackground, 6 * 60 * 60 * 1000);
  </script>
</body>
</html>
