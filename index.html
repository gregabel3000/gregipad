<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clock + Weather Forecast</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: black;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
    text-align: center;
  }

  #container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  #time {
    font-size: 10vw;
    font-weight: 600;
    line-height: 1;
  }

  #seconds {
    font-size: 4vw;
    vertical-align: super;
  }

  #date {
    font-size: 3vw;
    margin-top: 1vw;
  }

  #weather {
    font-size: 3vw;
    margin-top: 2vw;
  }

  #forecast {
    font-size: 2vw;
    margin-top: 2vw;
    line-height: 1.6;
    max-width: 90vw;
  }

  .forecast-item {
    margin: 0.5vw 0;
  }
</style>
</head>
<body>
<div id="container">
  <div id="time">--:--<span id="seconds">--</span></div>
  <div id="date">Loading date...</div>
  <div id="weather">Loading weather...</div>
  <div id="forecast">Loading forecast...</div>
</div>

<script>
  const timeEl = document.getElementById("time");
  const secEl = document.getElementById("seconds");
  const dateEl = document.getElementById("date");
  const weatherEl = document.getElementById("weather");
  const forecastEl = document.getElementById("forecast");

  // CLOCK
  function updateClock() {
    const now = new Date();
    let hours = now.getHours();
    const minutes = now.getMinutes().toString().padStart(2, "0");
    const seconds = now.getSeconds().toString().padStart(2, "0");
    const ampm = hours >= 12 ? "PM" : "AM";
    hours = hours % 12 || 12;

    timeEl.firstChild.nodeValue = `${hours}:${minutes}`;
    secEl.textContent = seconds;
    dateEl.textContent = now.toDateString();
  }

  setInterval(updateClock, 1000);
  updateClock();

  // WEATHER + FORECAST
  async function getWeather(zip = "01301") {
    try {
      const res = await fetch(`https://wttr.in/${zip}?format=j1&u=f`);
      if (!res.ok) throw new Error("Failed to fetch weather");
      const data = await res.json();

      // CURRENT CONDITIONS
      const current = data.current_condition[0];
      const tempF = current.temp_F;
      const condition = current.weatherDesc[0].value;
      weatherEl.textContent = `Now: ${tempF}°F, ${condition}`;

      // 12-HOUR FORECAST (first 4 x 3-hour chunks)
      const todayHours = data.weather[0].hourly.slice(0, 4);
      forecastEl.innerHTML = "<strong>Next 12 hours:</strong><br>";

      todayHours.forEach(hour => {
        const timeLabel = formatTime(hour.time);
        const desc = hour.weatherDesc[0].value;
        const temp = hour.tempF;
        const rain = hour.chanceofrain;
        const item = document.createElement("div");
        item.classList.add("forecast-item");
        item.textContent = `${timeLabel}: ${temp}°F, ${desc} (Rain: ${rain}%)`;
        forecastEl.appendChild(item);
      });

    } catch (err) {
      console.error(err);
      weatherEl.textContent = "Weather unavailable.";
      forecastEl.textContent = "";
    }
  }

  // Convert wttr time (e.g., "0", "300", "600") into readable format
  function formatTime(t) {
    const num = parseInt(t, 10);
    const hours = Math.floor(num / 100);
    const date = new Date();
    date.setHours(hours);
    date.setMinutes(0);
    let label = date.toLocaleTimeString([], { hour: 'numeric', hour12: true });
    return label;
  }

  getWeather();
</script>
</body>
</html>
